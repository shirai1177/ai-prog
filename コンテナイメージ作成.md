# コンテナイメージ作成手順

## 研修テキストを更新した場合

### メインテキストの場合

メインテキストのpdfファイル名を、「AI_Main.pdf」にしてcontainer-farmにアップロードする。

### ハンズオンテキストの場合

* GitBucketのダウンロードで、ZIPファイルをダウンロードする。
* ファイルを展開して、readme.mdを削除したうえで以下のコピーを実行し1ファイルにまとめる
```
copy *.md all.md
```
* all.mdを開き、改ページタグの後に空白行を入れる。（置換機能を利用）
* Markdown Preview Plusのブラウザに読み込み、PDF保存をする。
* ページの挿入も行なう。（WEBサービス利用）
* ファイル名を「AI_HandsOn.pdf」にしてcontainer-farmにアップロードする。

* ai-eduサーバにログインし、adminユーザになる。
* sudo kill [gitbucketのpid]　でGitbucketを終了する。
* repo_make.shを実行し、リポジトリを固めCloudStorageにコピーする。

### container-farmでの作業

* ai-docのコンテナとイメージを消す。
* ai-docフォルダに移動し、container_make.shを実行
* ai-docコンテナができていて、ai-doc.tarがCloudStorageにコピーされたことを確認
* ai-downloadのコンテナとイメージを消す。
* ai-dlフォルダに移動し、container_make.shを実行
* ai-downloadコンテナができていて、tarイメージがCloudStrageにコピーされたことを確認

### 10.160.152.20のローカルサーバでの作業

* ai-doc.tarをダウンロードし、dockerホストにアップロードする
* 以下のdockerコマンドを実行しイメージをロードする
```
docker load -i ai-doc.tar
```
* イメージがロードされたことを確認し、コンテナを起動する
```
docker run -d -e TZ=Asia/Tokyo -p 8080:8080 metroedu/ai-doc
```
* ai-dl.tarをダウンロードし、dockerホストにアップロードする
* 以下のdockerコマンドを実行しイメージをロードする
```
docker load -i ai-dl.tar
```
* イメージがロードされたことを確認し、コンテナを起動する
```
docker run -d -e TZ=Asia/Tokyo -p 80:80 metroedu/ai-download
```
